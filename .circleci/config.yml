version: 2.1

executors:
  base:
    docker:
      - image: cimg/base:stable

commands:
      enable_logging:
        steps:
          - run:
              command: |
                exec &> >(tee -a /tmp/logs/build_output.txt)
                set -x
                echo 'set -x' >> $BASH_ENV
                echo 'exec &> >(tee -a /tmp/logs/build_output.txt)' >> $BASH_ENV
      store_build_logs:
        steps:
          - store_artifacts:
              path: /tmp/logs/build_output.txt

jobs:
  job_a:
    executor: base
    steps:
      - checkout
      - run: echo "Running job a"
      - run: cat path_a/README.md
  job_b:
    executor: base
    steps:
      - checkout
      - run: echo "running job b"
      - run: cat path_b/README.md

workflows:
  workflow-a:
    jobs:
      - job_a:
          pre-steps:
            - run: enable_logging
          post-steps:
            - run: store_build_logs
      - job_b:
          pre-steps:
            - run: enable_logging
          post-steps:
            - run: store_build_logs